--------------------------------------------------------
--  DDL for Procedure P_ORDTRAMOS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "AXIS"."P_ORDTRAMOS" (TRAM NUMBER) authid current_user IS
CON NUMBER;
MAXIM NUMBER; --Per començar en un rang que no estigui ocupat
MAXI NUMBER;
BEGIN
SELECT MAX(ORDEN),COUNT(*) INTO MAXIM,CON
FROM SGT_DET_TRAMOS
WHERE TRAMO = TRAM;
MAXI:=MAXIM;
  FOR I IN (SELECT *
		FROM SGT_DET_TRAMOS
		WHERE TRAMO = TRAM
		ORDER BY DESDE)
  LOOP
	MAXIM := MAXIM+1;
	UPDATE SGT_DET_TRAMOS
	SET ORDEN=MAXIM
	WHERE TRAMO = TRAM AND ORDEN = I.ORDEN;
  END LOOP;
  UPDATE SGT_DET_TRAMOS
  SET ORDEN=ORDEN-MAXI
  WHERE TRAMO = TRAM;
COMMIT;
END;

 
 

/

  GRANT EXECUTE ON "AXIS"."P_ORDTRAMOS" TO "R_AXIS";
  GRANT EXECUTE ON "AXIS"."P_ORDTRAMOS" TO "CONF_DWH";
  GRANT EXECUTE ON "AXIS"."P_ORDTRAMOS" TO "PROGRAMADORESCSI";
