--------------------------------------------------------
--  DDL for Function F_DESCCC
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "AXIS"."F_DESCCC" (PTCUENTA IN VARCHAR2, PNFORMATO IN NUMBER, PTSALIDA IN
		     OUT VARCHAR2) RETURN NUMBER
authid current_user IS
XCBANCO NUMBER;
XCOFICIN NUMBER;
STBANCO VARCHAR2(36);
STOFICIN VARCHAR2(36);
BEGIN
PTSALIDA := ' ';
IF PNFORMATO = 1 THEN
XCBANCO := TO_NUMBER(SUBSTR(PTCUENTA, 1, 4));
XCOFICIN := TO_NUMBER(SUBSTR(PTCUENTA, 5, 4));
BEGIN
	SELECT TBANCO, TOFICIN
	INTO STBANCO, STOFICIN
	FROM OFICINAS
	WHERE CBANCO = XCBANCO AND COFICIN = XCOFICIN;
	PTSALIDA := LTRIM(RTRIM(STBANCO)) || ' - ' || LTRIM(RTRIM(STOFICIN));
	RETURN 0;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
	  RETURN 102445;		-- OFICINA NO EXISTENT
	WHEN TOO_MANY_ROWS THEN
	  RETURN 102446;		-- OFICINA REPETIDA A LA TAULA OFICINAS
	WHEN OTHERS THEN
	  RETURN 101916;		-- ERROR A LA BASE DE DADES
END;
ELSE
RETURN 101901;	-- PAS INCORRECTE DE PARÀMETRES A LA FUNCIÓ
END IF;
END;
 
 

/

  GRANT EXECUTE ON "AXIS"."F_DESCCC" TO "R_AXIS";
  GRANT EXECUTE ON "AXIS"."F_DESCCC" TO "CONF_DWH";
  GRANT EXECUTE ON "AXIS"."F_DESCCC" TO "PROGRAMADORESCSI";
