--------------------------------------------------------
--  DDL for Trigger MOD_CCAUSIN_CMOTSIN
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "AXIS"."MOD_CCAUSIN_CMOTSIN" 
  AFTER UPDATE ON SINIESTROS
  FOR EACH ROW
          WHEN (
(NEW.ccausin <> OLD.ccausin) OR (NEW.cmotsin <> OLD.cmotsin)
      ) DECLARE
  PNMOVIMI NUMBER;
  PFCONTAB DATE:=NULL;
  ERROR NUMBER;
BEGIN
  SELECT NVL(MAX(nmovimi) + 1,1)
  INTO pnmovimi
  FROM MOVSINIESTRO
  WHERE nsinies = :NEW.nsinies;
  ERROR := F_Fcontabsini(:NEW.sseguro,F_SYSDATE,PFCONTAB);
  IF ERROR <> 0 THEN
    RAISE_APPLICATION_ERROR(-20001,'ERROR : LAS CONSULTAS DE LA FUNCIÓN HAN PRODUCIDO EL ERROR            '||TO_CHAR(ERROR));
  END IF;

  INSERT INTO MOVSINIESTRO (NSINIES,NMOVIMI,FMOVIMI,CUSUMOV,CESTADO,CMOVSIN,CCAUSIN,CMOTSIN,FCONTAB)
  VALUES (:NEW.NSINIES,PNMOVIMI,F_SYSDATE,F_USER,:NEW.CESTSIN,2,:NEW.CCAUSIN,:NEW.CMOTSIN,PFCONTAB);
END;









/
ALTER TRIGGER "AXIS"."MOD_CCAUSIN_CMOTSIN" ENABLE;
