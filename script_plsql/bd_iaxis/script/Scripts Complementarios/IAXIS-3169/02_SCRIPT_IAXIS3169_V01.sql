/*IAXIS-3169*/

/* BORRADO DE LAS RESPUESTA*/
DELETE FROM RESPUESTAS WHERE CPREGUN = 2876 AND CRESPUE BETWEEN 19 AND 23;
DELETE FROM CODIRESPUESTAS WHERE CPREGUN = 2876 AND CRESPUE BETWEEN 19 AND 23;

/* ACTUALIZACION DE ACTIVIDAD 0 (GARANTIA UNICA) DE LA RESPUESTA*/

UPDATE RESPUESTAS SET CACTIVI = 0 WHERE CPREGUN = 2876 AND CRESPUE BETWEEN 1 AND 5;

/* INSERCION DE NUEVAS RESPUESTAS PARA LA ACTIVIDAD 1 -> PARTICULAR */

INSERT INTO CODIRESPUESTAS (CPREGUN, CRESPUE) VALUES (2876, 19);
INSERT INTO CODIRESPUESTAS (CPREGUN, CRESPUE) VALUES (2876, 20);
INSERT INTO CODIRESPUESTAS (CPREGUN, CRESPUE) VALUES (2876, 21);

INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (19, 2876, 1, '.', 1);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (19, 2876, 2, '.', 1);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (19, 2876, 8, '.', 1);

INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (20, 2876, 1, 'Banco de la República', 1);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (20, 2876, 2, 'Banco de la República', 1);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (20, 2876, 8, 'Banco de la República', 1);

INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (21, 2876, 1, 'Zona Franca', 1);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (21, 2876, 2, 'Zona Franca', 1);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (21, 2876, 8, 'Zona Franca', 1);

/* INSERCION DE NUEVAS RESPUESTAS PARA LA ACTIVIDAD 2 -> ECOPETROL*/

INSERT INTO CODIRESPUESTAS (CPREGUN, CRESPUE) VALUES (2876, 22);

INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (22, 2876, 1, '.', 2);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (22, 2876, 2, '.', 2);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (22, 2876, 8, '.', 2);

/* INSERCION DE NUEVAS RESPUESTAS PARA LA ACTIVIDAD 3 -> SERVICIOS PUBLICOS */

INSERT INTO CODIRESPUESTAS (CPREGUN, CRESPUE) VALUES (2876, 23);

INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (23, 2876, 1, '.', 3);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (23, 2876, 2, '.', 3);
INSERT INTO RESPUESTAS (CRESPUE, CPREGUN, CIDIOMA, TRESPUE, CACTIVI) VALUES (23, 2876, 8, '.', 3);

/* ACTUALIZACION DE CONSULTA DINAMICA DE RESPUESTAS A LA PREGUNTA 2876*/

UPDATE CODIPREGUN SET TCONSULTA = 'SELECT CRESPUE, TRESPUE FROM (SELECT * FROM RESPUESTAS
       WHERE CPREGUN=2876 AND CIDIOMA=:PMT_IDIOMA AND CACTIVI = :PMT_CACTIVI) A,
       (SELECT NVL(MAX(R.CRESPUE),1) CATEG FROM ESTPREGUNPOLSEG R
       WHERE CPREGUN = 2875 AND NMOVIMI = (SELECT MAX(NMOVIMI)
       FROM ESTPREGUNPOLSEG P2 WHERE P2.CPREGUN = 2875)) B
WHERE ((:PMT_SPRODUC NOT IN (8054,8055,8056,8057,8058,8059,8060,8061, 8093, 8094, 8095) AND CRESPUE BETWEEN 1 AND 5)
	 OR(:PMT_SPRODUC NOT IN (8054,8055,8056,8057,8058,8059,8060,8061, 8093, 8094, 8095) AND CRESPUE BETWEEN 19 AND 21)
	 OR(:PMT_SPRODUC NOT IN (8054,8055,8056,8057,8058,8059,8060,8061, 8093, 8094, 8095) AND CRESPUE = 22)
	 OR(:PMT_SPRODUC NOT IN (8054,8055,8056,8057,8058,8059,8060,8061, 8093, 8094, 8095) AND CRESPUE = 23)
   OR (:PMT_SPRODUC IN (8054,8055,8056,8057,8058,8059,8060,8061) AND CRESPUE BETWEEN 6 AND 10 AND CATEG = 1)
   OR (:PMT_SPRODUC IN (8054,8055,8056,8057,8058,8059,8060,8061) AND CRESPUE BETWEEN 11 AND 12 AND CATEG = 2)
   OR (:PMT_SPRODUC IN (8054,8055,8056,8057,8058,8059,8060,8061) AND CRESPUE BETWEEN 13 AND 14 AND CATEG = 3)
   OR (:PMT_SPRODUC IN (8054,8055,8056,8057,8058,8059,8060,8061) AND CRESPUE = 15 AND CATEG = 4)
   OR (:PMT_SPRODUC IN (8093) AND CRESPUE = 16)
   OR (:PMT_SPRODUC IN (8094) AND CRESPUE = 17)
   OR (:PMT_SPRODUC IN (8095) AND CRESPUE = 18))' WHERE CPREGUN = 2876;

commit;
/

