----- DELETE VISTA ----------
BEGIN
    PAC_SKIP_ORA.p_comprovadrop('DIM_CIRCULARCONOCIMIENTO','MATERIALIZED VIEW');  
END;
/

----- CREATE VISTA ----------
CREATE MATERIALIZED VIEW "CONF_DWH"."DIM_CIRCULARCONOCIMIENTO" ("CCC_ID", "CCC_CODIGO", "CCC_PERSONA", "CCC_PERSONA_NOMBRE", "CCC_TIPODOCUMENTO", "CCC_TIPODOCUMENTO_DESC", "CCC_FECHADOCUMENTO", 
 "FECHA_REGISTRO", "ESTADO", "START_ESTADO", "END_ESTADO", "FECHA_CONTROL", "FECHA_INICIAL", "FECHA_FIN" )
ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "CONF_DWH"   NO INMEMORY 
BUILD IMMEDIATE
USING INDEX 
REFRESH COMPLETE ON DEMAND START WITH SYSDATE+0 NEXT SYSDATE + 1
USING DEFAULT LOCAL ROLLBACK SEGMENT
USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
AS SELECT CCC_ID.NEXTVAL@BODEGA CCC_ID,
p.sperson CCC_CODIGO, 
p.nnumide CCC_PERSONA, 
pd.TNOMBRE1 || ' ' || pd.TNOMBRE2 ||  ' ' || pd.TAPELLI1 || ' ' || pd.TAPELLI2 CCC_PERSONA_NOMBRE, 
p.ctipide CCC_TIPODOCUMENTO, 
AXIS.FF_DESVALORFIJO(672, 8, P.CTIPIDE) CCC_TIPODOCUMENTO_DESC, 
pi.FECHADEXP CCC_FECHADOCUMENTO, 
AXIS.F_SYSDATE FECHA_REGISTRO, 
'ACTIVO' ESTADO,
AXIS.F_SYSDATE START_ESTADO,
AXIS.F_SYSDATE  END_ESTADO,
AXIS.F_SYSDATE FECHA_CONTROL,
TRUNC(AXIS.F_SYSDATE, 'MONTH') FECHA_INICIAL,
TRUNC(LAST_DAY(SYSDATE)) FECHA_FIN
FROM AXIS.Per_Personas p,  
 AXIS.per_detper pd, 
 AXIS.PER_IDENTIFICADOR pi
where p.sperson = pd.sperson
and pi.sperson = p.sperson
and pi.ctipide = p.ctipide
and pi.nnumide = p.nnumide
;

COMMENT ON MATERIALIZED VIEW "CONF_DWH"."DIM_CIRCULARCONOCIMIENTO"  IS 'snapshot table for snapshot DWH_CONF.DIM_CIRCULARCONOCIMIENTO';