----- DELETE VISTA ----------
BEGIN
    PAC_SKIP_ORA.p_comprovadrop('DIM_POLIZA','MATERIALIZED VIEW');  
END;
/

----- CREATE VISTA ----------
CREATE MATERIALIZED VIEW "CONF_DWH"."DIM_POLIZA" ("POL_ID", "POL_NUM_POLIZA", "POL_FECHA_EXP_POL", "POL_ANNO_EXP_POL", "POL_FEC_INI_POL", "POL_FEC_FIN_POL", "POL_SUCUR", "POL_CERTIF", "POL_VBASE",
 "FECHA_REGISTRO", "ESTADO", "START_ESTADO", "END_ESTADO", "FECHA_CONTROL")
ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "CONF_DWH"   NO INMEMORY 
BUILD IMMEDIATE
USING INDEX 
REFRESH COMPLETE ON DEMAND START WITH SYSDATE+0 NEXT SYSDATE + 1
USING DEFAULT LOCAL ROLLBACK SEGMENT
USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
AS SELECT SEQ_OUT_POLIZA_POL_ID.NEXTVAL@BODEGA POL_ID, 
S.NPOLIZA POL_NUM_POLIZA,
TRUNC(S.FEMISIO) POL_FECHA_EXP_POL, 
EXTRACT(YEAR FROM S.FEMISIO) POL_ANNO_EXP_POL, 
S.FEFECTO POL_FEC_INI_POL, 
S.FVENCIM POL_FEC_FIN_POL, 
AXIS.PAC_AGENTES.F_GET_CAGELIQ(24, 2, S.CAGENTE) POL_SUCUR, 
RDM.NCERTDIAN POL_CERTIF, 
S.IPRIANU POL_VBASE, 
AXIS.F_SYSDATE FECHA_REGISTRO, 
'ACTIVO' ESTADO,
AXIS.F_SYSDATE START_ESTADO,
AXIS.F_SYSDATE END_ESTADO,
AXIS.F_SYSDATE FECHA_CONTROL
FROM AXIS.SEGUROS S, AXIS.RANGO_DIAN_MOVSEGURO RDM, AXIS.MOVSEGURO M 
WHERE M.SSEGURO = RDM.SSEGURO
AND M.NMOVIMI = RDM.NMOVIMI(+) 
AND S.SSEGURO = M.SSEGURO
;

COMMENT ON MATERIALIZED VIEW "CONF_DWH"."DIM_POLIZA"  IS 'SNAPSHOT TABLE FOR SNAPSHOT DWH_CONF.DIM_POLIZA';
