----- DELETE VISTA ----------	
BEGIN
    PAC_SKIP_ORA.p_comprovadrop('DIM_ENTIDAD','MATERIALIZED VIEW');  
END;
/

----- CREATE VISTA ----------
CREATE MATERIALIZED VIEW "CONF_DWH"."DIM_ENTIDAD" ("ENT_ID", "ENT_CODIGO", "ENT_NIT", "ENT_TIPPER", "ENT_NOMBRE",  
 "FECHA_REGISTRO", "ESTADO", "START_ESTADO", "END_ESTADO", "FECHA_CONTROL", "CATTRIBUTARIA", "DIGITO" )
ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "CONF_DWH"   NO INMEMORY 
BUILD IMMEDIATE
USING INDEX 
REFRESH COMPLETE ON DEMAND START WITH SYSDATE+0 NEXT SYSDATE + 1
USING DEFAULT LOCAL ROLLBACK SEGMENT
USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
AS SELECT SEQ_OUT_ENTIDAD_ENT_ID.NEXTVAL@BODEGA ENT_ID,  
C.CCOMPANI ENT_CODIGO, 
P.NNUMIDE ENT_NIT, 
P.CTIPPER ENT_TIPPER, 
PD.TNOMBRE1 || ' ' || PD.TNOMBRE2 ||  ' ' || PD.TAPELLI1 || ' ' || PD.TAPELLI2 ENT_NOMBRE, 
AXIS.F_SYSDATE FECHA_REGISTRO, 
'ACTIVO' ESTADO,
AXIS.F_SYSDATE START_ESTADO,
AXIS.F_SYSDATE END_ESTADO,
AXIS.F_SYSDATE FECHA_CONTROL, 
PR.CREGFISCAL CATTRIBUTARIA,
' ' DIGITO
FROM AXIS.COMPANIAS C, AXIS.PER_PERSONAS P, AXIS.PER_DETPER PD, AXIS.PER_REGIMENFISCAL PR
WHERE C.SPERSON = P.SPERSON
AND P.SPERSON = PD.SPERSON
AND P.SPERSON = PR.SPERSON(+)
;

COMMENT ON MATERIALIZED VIEW "CONF_DWH"."DIM_ENTIDAD"  IS 'SNAPSHOT TABLE FOR SNAPSHOT DWH_CONF.DIM_ENTIDAD';
