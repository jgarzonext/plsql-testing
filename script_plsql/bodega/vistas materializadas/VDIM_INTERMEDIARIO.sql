--------------------------------------------------------
--  DDL for Materialized View VDIM_INTERMEDIARIO
--------------------------------------------------------

  CREATE MATERIALIZED VIEW "CONF_DWH"."VDIM_INTERMEDIARIO" ("INTERMEDIARIO_TID", "INTERMEDIARIO", "INTERMEDIARIO_NOM", "INTERMEDIARIO_TAMANO", "DIRECC_OFICINA", "CIUDAD", "DEPARTAMENTO", "EMAIL", "TELEFONO_CELULAR", "TELEFONO_OFICINA", "NUM_EXTENSION", "NUM_FAX", "CCIIU", "CIIU_DESC", "SUCURSAL", "REPRESENT_LEGAL", "CLAVE", "TIPO_CANAL", "FECHA_REGISTRO", "ESTADO", "START_ESTADO", "END_ESTADO", "FECHA_CONTROL", "FECHA_INICIAL", "FECHA_FIN")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 0 INITRANS 2 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CONF_DWH" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
  AS SELECT 
         AC.CTIPINT INTERMEDIARIO_TID,
         P.NNUMIDE INTERMEDIARIO,
         f_desagente_t(A.CAGENTE)INTERMEDIARIO_NOM,
         ' ' INTERMEDIARIO_TAMANO,
         NVL(PAC_ISQLFOR.F_DIRECCION(A.SPERSON, 1), ' ') DIRECC_OFICINA,
         NVL(PAC_ISQLFOR.F_POBLACION(A.SPERSON, 1), ' ') CIUDAD,
         NVL(PAC_ISQLFOR.F_PROVINCIA(A.SPERSON, 1), ' ') DEPARTAMENTO,
         NVL(PAC_ISQLFOR.F_PER_CONTACTOS(A.SPERSON, 3), ' ') EMAIL,
         NVL(PAC_ISQLFOR.F_PER_CONTACTOS(A.SPERSON, 6), ' ') TELEFONO_CELULAR,
         NVL(PAC_ISQLFOR.F_PER_CONTACTOS(A.SPERSON, 1), ' ') TELEFONO_OFICINA,
         ' 'NUM_EXTENSION,
         NVL(PAC_ISQLFOR.F_PER_CONTACTOS(A.SPERSON, 2), ' ') NUM_FAX,
          FIN.CCIIU,
          FIN.TATRIBU CIIU_DESC,
         pac_agentes.f_get_cageliq(24, 2, p.cagente) SUCURSAL,
         PAC_ISQLFOR_CONF.F_PER_RELACIONADAS(1,1,P.CAGENTE) REPRESENT_LEGAL,
         P.CAGENTE CLAVE,
         d.tatribu TIPO_CANAL,
         F_SYSDATE FECHA_REGISTRO, 
         'ACTIVO' ESTADO, 
         TO_DATE('01/01/1986') START_ESTADO,
         ' ' END_ESTADO, 
         F_SYSDATE FECHA_CONTROL,
         TRUNC(F_SYSDATE, 'month') FECHA_INICIAL,
         TRUNC(LAST_DAY(SYSDATE)) FECHA_FIN
    FROM 
         AGENTES A,
         AGENTES_COMP AC,
         PER_PERSONAS P,
         (SELECT FIN.SPERSON, FIN.CCIIU, DV.TATRIBU
          FROM FIN_GENERAL FIN,
               DETVALORES DV
          WHERE DV.CVALOR= 8001072 
             AND DV.CIDIOMA=8
             AND FIN.CCIIU=DV.CATRIBU) FIN,
          (SELECT d.tatribu, d.catribu
            FROM DETVALORES d
            WHERE d.CIDIOMA = 8
              AND d.CVALOR = 1062) D      
         WHERE AC.CAGENTE       =   A.CAGENTE
           AND A.SPERSON        =   P.SPERSON
           AND FIN.SPERSON(+)   =   P.SPERSON
           AND D.CATRIBU(+)     =   A.CTIPMED
           AND pac_contexto.f_inicializarctx(pac_parametros.f_parempresa_t(24,'USER_BBDD'))=0;

   COMMENT ON MATERIALIZED VIEW "CONF_DWH"."VDIM_INTERMEDIARIO"  IS 'snapshot table for snapshot CONF_DWH.VDIM_INTERMEDIARIO';
