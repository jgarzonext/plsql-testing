----- DELETE VISTA ----------
BEGIN
    PAC_SKIP_ORA.p_comprovadrop('DIM_REASEGURO','MATERIALIZED VIEW');  
END;
/

----- CREATE VISTA ----------
  CREATE MATERIALIZED VIEW "CONF_DWH"."DIM_REASEGURO" ("REASG_ID", "REASG_TIP_CONTRATO", "REASG_CONTRATO", "REASG_CONTRATO_DESC", 
  "REASG_REASEG", "REASG_REASEG_DESC", "FECHA_REGISTRO", "ESTADO", 
  "START_ESTADO", "END_ESTADO", "FECHA_CONTROL", "FECHA_INICIAL", "FECHA_FIN")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "CONF_DWH"   NO INMEMORY 
BUILD IMMEDIATE
USING INDEX 
REFRESH COMPLETE ON DEMAND START WITH sysdate+0 NEXT SYSDATE + 1
USING DEFAULT LOCAL ROLLBACK SEGMENT
USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
  AS SELECT REASG_ID.NEXTVAL@BODEGA REASG_ID,
       DECODE(C.CTIPREA,1,'SN CUOTA APARTE',5,'FACULTATIVOS',3,'xl',2,'EXCEDENTES')REASG_TIP_CONTRATO,
       C.SCONTRA REASG_CONTRATO, 
       C.TDESCRIPCION REASG_CONTRATO_DESC,
       CC.CCOMPANI REASG_REASEG, 
       --DP.TPAIS REASG_PAIS,
       COM.TCOMPANI REASG_REASEG_DESC,
       AXIS.F_SYSDATE FECHA_REGISTRO,
       'ACTIVO' ESTADO,
       TO_DATE('01/01/1986') START_ESTADO,
       AXIS.F_SYSDATE END_ESTADO,
       AXIS.F_SYSDATE FECHA_CONTROL,
       TRUNC(AXIS.F_SYSDATE, 'month') FECHA_INICIAL,
       TRUNC(LAST_DAY(AXIS.F_SYSDATE)) FECHA_FIN
FROM AXIS.CODICONTRATOS C,  AXIS.COMPANIAS COM,
  (SELECT CCOMPANI, SCONTRA, MAX(CTRAMO)
      FROM AXIS.CUADROCES
      GROUP BY CCOMPANI, SCONTRA )CC,
  (SELECT CPAIS, TPAIS
      FROM AXIS.DESPAISES DP
      WHERE CIDIOMA=8)DP
WHERE C.SCONTRA   =   CC.SCONTRA
  AND CC.CCOMPANI =   COM.CCOMPANI
  AND COM.CPAIS   =   DP.CPAIS(+);

   COMMENT ON MATERIALIZED VIEW "CONF_DWH"."DIM_REASEGURO"  IS 'snapshot table for snapshot DWH_CONF.DIM_REASEGURO';
