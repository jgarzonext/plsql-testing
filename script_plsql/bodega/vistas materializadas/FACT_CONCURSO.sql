----- DELETE VISTA ----------
BEGIN
    PAC_SKIP_ORA.p_comprovadrop('FACT_CONCURSO','MATERIALIZED VIEW');  
END;
/

----- CREATE VISTA ----------
  CREATE MATERIALIZED VIEW "CONF_DWH"."FACT_CONCURSO" ("FCONC_ID", "FCONC_META", "FECHA_REGISTRO", "ESTADO", "START_ESTADO", "END_ESTADO", "FECHA_CONTROL", 
  "FECHA_INICIAL", "FECHA_FIN", "FCONC_FK_FECHA_VIN_CONC", "FCONC_FK_SUCURSAL", "FCONC_FK_SUCURSAL_ORIGEN", "FCONC_FK_AGENTE", "FCONC_FK_CONCURSO",
  "FCONC_META_2", "FCONC_META_3", "FCONC_INT_NOMBRE", "FCONC_META_4", "FCONC_META_5", "FCONC_META_6")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "CONF_DWH"   NO INMEMORY 
BUILD IMMEDIATE
USING INDEX 
REFRESH COMPLETE ON DEMAND START WITH SYSDATE+0 NEXT SYSDATE + 1
USING DEFAULT LOCAL ROLLBACK SEGMENT
USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
  AS SELECT  SEQ_FCONC_ID.NEXTVAL@BODEGA FCONC_ID,
          nvl(CA.IMETA,0) FCONC_META,
          AXIS.F_SYSDATE FECHA_REGISTRO,
          'ACTIVO' ESTADO,
          TO_DATE('01/01/1986') START_ESTADO,
          AXIS.F_SYSDATE END_ESTADO,
          AXIS.F_SYSDATE FECHA_CONTROL,
          TRUNC(AXIS.F_SYSDATE, 'MONTH') FECHA_INICIAL,
          TRUNC(LAST_DAY(AXIS.F_SYSDATE)) FECHA_FIN,
          DTM.TIE_ID FCONC_FK_FECHA_VIN_CONC,
          DG.GEO_ID FCONC_FK_SUCURSAL,
          DG.GEO_ID FCONC_FK_SUCURSAL_ORIGEN,
          CA.CAGENTE FCONC_FK_AGENTE,
          DC.CONC_ID FCONC_FK_CONCURSO, 
      '0' FCONC_META_2,
      '0' FCONC_META_3,
      '0' FCONC_INT_NOMBRE,
      '0' FCONC_META_4,
      '0' FCONC_META_5,
      '0' FCONC_META_6
   FROM AXIS.CAMPAAGE CA, CONF_DWH.DIM_CONCURSO DC, DIM_TIEMPO@BODEGA DTM, DIM_GEOGRAFICA@BODEGA DG
   WHERE CA.CCODIGO = DC.CONC_CONCURSO
   AND CA.FINICAM  = DTM.TIE_FECHA
   AND DG.GEO_SUCURSAL = SUBSTR(AXIS.PAC_AGENTES.F_GET_CAGELIQ(24, CA.CTIPAGE, CA.CAGENTE), 3,5) 
   AND CA.CTIPAGE IN (2,3)
   ;
 

   COMMENT ON MATERIALIZED VIEW "CONF_DWH"."FACT_CONCURSO"  IS 'SNAPSHOT TABLE FOR SNAPSHOT DWH_CONF.FACT_CONCURSO';
