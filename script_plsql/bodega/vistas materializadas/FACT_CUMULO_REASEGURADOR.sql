--------------------------------------------------------
--  DDL for Materialized View FACT_CUMULO_REASEGURADOR
--------------------------------------------------------

  CREATE MATERIALIZED VIEW "CONF_DWH"."FACT_CUMULO_REASEGURADOR" ("REASG_ID", "SERIE", "CONTRATO", "TEC_ID", "CESION")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 0 INITRANS 2 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CONF_DWH" 
  BUILD IMMEDIATE
  USING INDEX 
  REFRESH FORCE ON DEMAND
  USING DEFAULT LOCAL ROLLBACK SEGMENT
  USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
  AS SELECT C.CCOMPANI REASG_ID,
       TO_CHAR(CT.FCONINI,'YYYY')||'-'||CC.CTIPREA SERIE,
       ff_desvalorfijo(106, 8, cc.ctiprea) CONTRATO,
       ' ' TEC_ID,
       SUM((T.ITOTTRA* C.PCESION)/100) CESION
FROM TRAMOS T, CODICONTRATOS CC, CUADROCES C, CONTRATOS CT
WHERE T.SCONTRA=700
AND T.SCONTRA=CC.SCONTRA
AND T.SCONTRA=C.SCONTRA  
AND T.NVERSIO=C.NVERSIO
AND T.CTRAMO=C.CTRAMO
AND CT.SCONTRA=C.SCONTRA  
AND CT.NVERSIO=C.NVERSIO

GROUP BY C.CCOMPANI,
TO_CHAR(CT.FCONINI,'YYYY')||'-'||CC.CTIPREA ,
       T.SCONTRA , 
       ff_desvalorfijo(106, 8, cc.ctiprea),
       CC.TDESCRIPCION;

   COMMENT ON MATERIALIZED VIEW "CONF_DWH"."FACT_CUMULO_REASEGURADOR"  IS 'snapshot table for snapshot DWH_CONF.FACT_CUMULO_REASEGURADOR';
