----- DELETE VISTA ----------
BEGIN
    PAC_SKIP_ORA.p_comprovadrop('DIM_RIESGO','MATERIALIZED VIEW');  
END;
/

----- CREATE VISTA ----------
  CREATE MATERIALIZED VIEW "CONF_DWH"."DIM_RIESGO" ("RIES_ID", "RIES_PRODUCTO", "RIES_DETALLE", "RIES_PRODUCTO_DESC", "RIES_RIESGO", "RIESGO_DESC", "FECHA_REGISTRO", "ESTADO", "START_ESTADO", "END_ESTADO", "FECHA_CONTROL", "FECHA_INICIAL", "FECHA_FIN")
  ORGANIZATION HEAP PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
NOCOMPRESS LOGGING
STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
TABLESPACE "CONF_DWH"   NO INMEMORY 
BUILD IMMEDIATE
USING INDEX 
REFRESH COMPLETE ON DEMAND START WITH sysdate+0 NEXT SYSDATE + 1
USING DEFAULT LOCAL ROLLBACK SEGMENT
USING ENFORCED CONSTRAINTS DISABLE QUERY REWRITE
  AS SELECT RIES_ID.NEXTVAL@BODEGA RIES_ID, 
P.SPRODUC RIES_PRODUCTO,
       ' ' RIES_DETALLE,
       T.TTITULO RIES_PRODUCTO_DESC,
       GP.CGARANT RIES_RIESGO,
       GG.TGARANT RIES_RIESGO_DESC,
       AXIS.F_SYSDATE FECHA_REGISTRO,
       'ACTIVO' ESTADO,
       TO_DATE('01/01/1986') START_ESTADO,
       AXIS.F_SYSDATE END_ESTADO,
       AXIS.F_SYSDATE FECHA_CONTROL,
       TRUNC(AXIS.F_SYSDATE, 'MONTH') FECHA_INICIAL,
       TRUNC(LAST_DAY(SYSDATE)) FECHA_FIN
FROM  AXIS.PRODUCTOS P, AXIS.TITULOPRO T, 
AXIS.GARANGENPRO GP, AXIS.GARANPRO GR, AXIS.GARANGEN GG
WHERE P.SPRODUC = GP.SPRODUC
AND P.CRAMO = T.CRAMO
AND P.CMODALI = T.CMODALI
AND P.CTIPSEG = T.CTIPSEG
AND P.CCOLECT = T.CCOLECT
AND T.CIDIOMA = 8
AND T.CIDIOMA = GP.CIDIOMA
AND GR.CRAMO = P.CRAMO
AND GR.SPRODUC = P.SPRODUC
AND GR.SPRODUC = GP.SPRODUC
AND GR.CGARANT = GP.CGARANT
AND GG.CGARANT = GR.CGARANT
AND GG.CGARANT = GP.CGARANT
AND GG.CIDIOMA = T.CIDIOMA
AND P.CMODALI = T.CMODALI
AND P.CMODALI = GR.CMODALI
AND GP.CACTIVI = GR.CACTIVI
;

COMMENT ON MATERIALIZED VIEW "CONF_DWH"."DIM_RIESGO"  IS 'SNAPSHOT TABLE FOR SNAPSHOT DWH_CONF.DIM_RIESGO';
